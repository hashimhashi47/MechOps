<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Booking Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-[#d7e6e7] to-[#e8e4f2] min-h-screen flex overflow-hidden">

  <!-- Sidebar -->

    {{ template "sidebar" }}
 

  <!-- Main -->
  <main class="flex-1 p-10 overflow-y-auto">

    <!-- Header -->
    <div class="flex justify-between items-center mb-10">
      <div>
        <h2 class="text-4xl font-bold text-gray-800">Booking Management</h2>
        <p class="text-gray-500 mt-1 text-lg">Manage all customer bookings smoothly ðŸ”§</p>
      </div>
    </div>

    <!-- Booking Table Card -->
    <div class="bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl p-6">
      <h3 class="text-2xl font-semibold text-gray-800 mb-6">All Bookings</h3>

      <div class="overflow-x-auto rounded-2xl shadow max-h-[600px] overflow-y-auto">
        <table class="w-full text-left min-w-[1200px]">
          <thead class="bg-white/60 sticky top-0 z-10">
            <tr class="text-gray-700">
              <th class="p-4 w-[12%]">Booking ID</th>
              <th class="p-4 w-[14%]">Car</th>
              <th class="p-4 w-[12%]">Pickup</th>
              <th class="p-4 w-[12%]">Address</th>
              <th class="p-4 w-[14%]">Problem</th>
              <th class="p-4 w-[18%]">Assignment</th>
              <th class="p-4 w-[18%]">Action</th>
            </tr>
          </thead>
          <tbody id="bookingTable" class="bg-white/40"></tbody>
        </table>
      </div>
    </div>

    <script>
      async function loadBookings() {
        try {
          const res = await fetch("/Admin/AllBooking");
          const data = await res.json();
          console.log("Bookings data:", data);

          const table = document.getElementById("bookingTable");
          table.innerHTML = "";

          data.forEach(b => {
            table.innerHTML += `
        <tr class="border-b border-gray-300/30 hover:bg-white/60 transition">
          <td class="p-4 text-gray-800 align-top">${b.id}</td>
          <td class="p-4 text-gray-800 align-top">${b.carnumber} <br/> ${b.car}</td>
          <td class="p-4 text-gray-800 align-top">${b.date} <br/> ${b.time}</td>
          <td class="p-4 text-gray-800 align-top">${b.Address}</td>
          <td class="p-4 text-gray-800 align-top">${b.service}</td>

          <!-- Assignment Column -->
          <td class="p-4 align-top">
            <div class="flex flex-col gap-2 min-w-[150px]">
              <select id="worker-${b.id}" class="border px-2 py-1 rounded w-full text-sm">
                <option value="">Select Worker</option>
              </select>
              <select id="slot-${b.id}" class="border px-2 py-1 rounded w-full text-sm">
                <option value="">Select Slot</option>
              </select>
            </div>
          </td>

          <!-- Action Column -->
          <td class="p-4 align-top">
            <div class="flex flex-col gap-2 min-w-[130px]">
              <button onclick="updateStatus('${b.id}', 'approved')" class="bg-green-600 text-white px-3 py-2 rounded-xl shadow hover:bg-green-700 w-full text-sm font-medium">Approve</button>
              <button onclick="updateStatus('${b.id}', 'rejected')" class="bg-red-600 text-white px-3 py-2 rounded-xl shadow hover:bg-red-700 w-full text-sm font-medium">Reject</button>
              <button onclick="assignSlotWorker('${b.id}')" class="bg-blue-600 text-white px-3 py-2 rounded-xl shadow hover:bg-blue-700 w-full text-sm font-medium">Assign</button>
            </div>
          </td>
        </tr>
      `;
          });

        } catch (err) {
          console.error("Error loading bookings:", err);
        }
      }

      async function updateStatus(id, status) {
        try {
          await fetch(`/Admin/AllBooking/update/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ status })
          });
          loadBookings();
        } catch (err) {
          console.error("Error updating status:", err);
        }
      }

      async function assignSlotWorker(id) {
        const worker = document.getElementById(`worker-${id}`).value;
        const slot = document.getElementById(`slot-${id}`).value;

        if (!worker || !slot) {
          alert("Please select both worker and slot!");
          return;
        }

        try {
          await fetch(`/Admin/AllBooking/assign/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ worker, slot })
          });
          alert(`Assigned Worker: ${worker}, Slot: ${slot}`);
          loadBookings();
        } catch (err) {
          console.error("Error assigning slot/worker:", err);
        }
      }

      loadBookings();
    </script>

</body>

</html>