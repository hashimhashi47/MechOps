<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-[#C9DDE4] to-[#D9D5F0] min-h-screen flex overflow-hidden">

  <!-- Sidebar -->
  <aside class="w-64 bg-white/50 backdrop-blur-2xl border-r border-white/40 shadow-xl h-screen rounded-r-3xl p-6 flex flex-col">
    <h1 class="text-2xl font-semibold text-gray-900 mb-10 tracking-wide">MechOpsüèéÔ∏è</h1>

    <nav class="space-y-3 text-gray-800 font-medium">
          <a href="AdminDashboard.html" class="flex items-center gap-3 p-3 rounded-xl hover:bg-white hover:shadow border border-transparent hover:border-white/40">
        <span class="w-3 h-3 bg-[#1E848A] rounded-full"></span>
        Dashboard
      </a>
      <a href="UsersPage.html" class="flex items-center gap-3 p-3 rounded-xl hover:bg-white hover:shadow border border-transparent hover:border-white/40">
        <span class="w-3 h-3 bg-[#3B8FE3] rounded-full"></span>
        Users
      </a>
      <a href="StaffPage.html" class="flex items-center gap-3 p-3 rounded-xl hover:bg-white hover:shadow border border-transparent hover:border-white/40">
        <span class="w-3 h-3 bg-[#7C52D9] rounded-full"></span>
        Staff
      </a>
      <a href="BookingManagement.html" class="flex items-center gap-3 p-3 rounded-xl hover:bg-white hover:shadow border border-transparent hover:border-white/40">
        <span class="w-3 h-3 bg-[#E8B645] rounded-full"></span>
        Bookings
      </a>
       <a href="SlotOnGarage.html" class="flex items-center gap-3 p-3 rounded-xl hover:bg-white hover:shadow border border-transparent hover:border-white/40">
        <span class="w-3 h-3 bg-[#E8B645] rounded-full"></span>
        SlotOnGarage
      </a>
    </nav>
  </aside>
  <!-- Main Content -->
  <main class="flex-1 p-10 overflow-y-auto">

    <!-- Header -->
    <div class="flex justify-between items-center mb-10">
      <div>
        <h2 class="text-4xl font-bold text-gray-900 tracking-tight">User Management</h2>
        <p class="text-gray-600 mt-1 text-lg">Manage all registered users ‚öôÔ∏è</p>
      </div>

      <div class="flex items-center gap-5">
      </div>
    </div>

    <!-- Add User Button -->
    <div class="flex justify-between mb-6">
      <h2 class="text-xl font-semibold text-gray-900">Users</h2>
      <button onclick="toggleUserForm()" class="px-4 py-2 bg-gray-900 text-white rounded-xl shadow-lg">
        + Add User
      </button>
    </div>

    <!-- User Form (Glass UI) -->
    <form id="userForm" class="hidden p-6 mb-8 bg-white/60 backdrop-blur-xl border border-white/40 shadow-md rounded-3xl space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input class="p-3 border rounded-xl bg-white/70" placeholder="Name" id="name" required />
        <input class="p-3 border rounded-xl bg-white/70" placeholder="Email" id="email" required />
        <input class="p-3 border rounded-xl bg-white/70" placeholder="Phone" id="phone" required />
        <input class="p-3 border rounded-xl bg-white/70" placeholder="Password" id="password" />
      </div>

      <button class="px-6 py-3 bg-[#3B8FE3] text-white rounded-xl shadow-md" type="submit">Save</button>
      <input type="hidden" id="userId" />
    </form>

    <!-- USERS TABLE -->
    <section class="bg-white/60 backdrop-blur-xl border border-white/40 shadow-md rounded-3xl p-6">
      <table class="w-full text-left">
        <thead class="bg-white/60 rounded-xl">
          <tr class="text-gray-700">
            <th class="p-3">Name</th>
            <th class="p-3">Email</th>
            <th class="p-3">Phone</th>
            <th class="p-3">Actions</th>
          </tr>
        </thead>
        <tbody id="usersTable"></tbody>
      </table>
    </section>

  </main>

  <script>
 const API = "http://localhost:8080";

// ===============================
// üî• LOAD USERS
// ===============================
async function loadUsers() {
  const res = await fetch(`${API}/admin/users`);
  const data = await res.json();

  const table = document.getElementById("usersTable");
  table.innerHTML = "";

  data.Users.forEach((u) => {
    table.innerHTML += `
      <tr class="border-b border-gray-300/30 hover:bg-white/60 transition">
        <td class="p-4 text-gray-800">${u.name}</td>
        <td class="p-4 text-gray-800">${u.email}</td>
        <td class="p-4 text-gray-800">${u.phone}</td>

        <td class="p-4 flex gap-2">
          <button 
            onclick="editUser('${u.id}', '${u.name}', '${u.email}', '${u.phone}')"
            class="bg-yellow-500 text-white px-4 py-2 rounded-xl shadow hover:bg-yellow-600">
            Edit
          </button>

          <button 
            onclick="deleteUser('${u.id}')"
            class="bg-red-600 text-white px-4 py-2 rounded-xl shadow hover:bg-red-700">
            Delete
          </button>
        </td>
      </tr>
    `;
  });
}


// ===============================
// üî• CREATE / UPDATE USER
// ===============================
document.getElementById("userForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const id = document.getElementById("userId").value;

  const payload = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    phone: document.getElementById("phone").value,
    password: document.getElementById("password").value
  };

  if (id) {
    // UPDATE USER
    await fetch(`${API}/admin/user/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  } else {
    // CREATE USER
    await fetch(`${API}/admin/user`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  }

  toggleUserForm();
  loadUsers();
});


// ===============================
// üî• EDIT (prefill form)
// ===============================
function editUser(id, nameVal, emailVal, phoneVal) {
  toggleUserForm();

  document.getElementById("userId").value = id;
  document.getElementById("name").value = nameVal;
  document.getElementById("email").value = emailVal;
  document.getElementById("phone").value = phoneVal;
}


// ===============================
// üî• DELETE USER
// ===============================
async function deleteUser(id) {
  await fetch(`${API}/admin/user/${id}`, {
    method: "DELETE"
  });

  loadUsers();
}


// ===============================
// üî• TOGGLE FORM + RESET
// ===============================
function toggleUserForm() {
  document.getElementById("userForm").classList.toggle("hidden");
  resetUserForm();
}

function resetUserForm() {
  document.getElementById("userForm").reset();
  document.getElementById("userId").value = "";
}


// ===============================
// üî• ON LOAD
// ===============================
loadUsers();
  </script>

</body>
</html>
